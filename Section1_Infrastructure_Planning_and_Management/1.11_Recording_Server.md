# 1.11 Recording Server

## 概要

Horizon Recording Serverは、ユーザーセッションの記録を提供します。OCE-Hレベルでは、ユースケースの特定、前提条件の特定、記録基準の評価、デプロイと設定が求められます。

## Horizon Recording Serverのユースケースの特定

### ユースケース

#### コンプライアンス要件

**シナリオ**:
- 金融機関での取引記録
- 医療機関での患者情報アクセス記録
- 政府機関での機密情報アクセス記録

#### セキュリティ監査

**シナリオ**:
- 不正アクセスの検出
- セキュリティインシデントの調査
- 監査ログの生成

#### トレーニングとサポート

**シナリオ**:
- ユーザートレーニングの記録
- サポートチームの参照
- 問題の再現

> [!IMPORTANT]

> Recording Serverは、コンプライアンス要件やセキュリティ監査が必要な環境で特に重要です。

## Recording Serverデプロイメントの前提条件の特定

### システム要件

**要件**:
- Windows Server 2016以降
- Active Directoryドメイン参加
- CPU: 4コア以上（推奨: 8コア）
- メモリ: 8GB以上（推奨: 16GB）
- ディスク: 100GB以上（記録データ用）

### ネットワーク要件

**ポート**:
- **443 (HTTPS)**: 管理コンソール
- **902 (TCP)**: 録画データ転送

### ストレージ要件

**考慮事項**:
- 記録データの保存容量
- 記録期間
- 同時記録セッション数

**計算式**:
```
必要なストレージ = 同時記録セッション数 × 記録時間 × データレート
```

> [!WARNING]

> Recording Serverのストレージ要件は、記録セッション数と記録期間に応じて大幅に変動します。適切にサイジングしてください。

## 記録基準の評価（ローカルセッション、リモートセッション、グループで記録）

### 記録タイプ

#### ローカルセッション

**概要**:
- ローカルネットワーク内のセッション
- 低レイテンシ
- 高品質な記録

**設定**:
- Recording Server → Settings → Recording Types
- Local Sessionsを有効化

#### リモートセッション

**概要**:
- 外部ネットワークからのセッション
- UAG経由のセッション
- レイテンシの考慮が必要

**設定**:
- Recording Server → Settings → Recording Types
- Remote Sessionsを有効化

### グループベースの記録

**設定方法**:
1. Recording Server → Groups
2. 記録するグループを選択
3. 記録設定を適用

**設定項目**:
- 記録の有効/無効
- 記録品質
- 記録期間

> [!TIP]

> グループベースの記録により、特定のユーザーグループのみを記録できます。

## Recording Serverのデプロイと設定

### デプロイ手順

1. **Recording Serverのインストール**
   - インストーラーを実行
   - インストールウィザードの進行

2. **初期設定**
   - Service Accountの設定
   - ストレージの設定
   - ネットワーク設定

3. **Horizon Connection Serverとの統合**
   - Horizon Console → View Configuration → Recording
   - Recording Serverを追加
   - 接続テスト

### 設定項目

**記録設定**:
- 記録品質
- 記録形式
- ストレージの場所

**セキュリティ設定**:
- アクセス制御
- 暗号化設定
- 保持期間

## 録画ポリシーの詳細設定

### 録画ポリシーの作成

**ポリシー設定項目**:
- **記録対象**: ユーザー、グループ、プール
- **記録タイプ**: ローカル、リモート、すべて
- **記録品質**: 低、中、高
- **記録形式**: MP4、WMV
- **記録期間**: セッション全体、指定時間

**ポリシー作成手順**:

1. **Recording Server管理コンソールでの設定**
   ```
   Policies → New Policy
   - Policy Name: Compliance-Recording-Policy
   - Target: Group (Compliance-Users)
   - Recording Type: All Sessions
   - Quality: High
   - Format: MP4
   - Duration: Full Session
   ```

2. **条件の設定**
   - 時間帯による記録の有効/無効
   - ネットワーク位置による記録の有効/無効

## ストレージ管理とアーカイブ

### ストレージ管理

**ストレージ容量の計算**:
```
必要なストレージ = 同時記録セッション数 × 記録時間 × データレート × 記録期間
```

**データレートの目安**:
- **低品質**: 500 Kbps
- **中品質**: 1 Mbps
- **高品質**: 2-3 Mbps

**ストレージ管理の設定**:

1. **自動削除ポリシー**
   - 記録期間の設定（例: 90日）
   - 自動削除の有効化

2. **アーカイブ設定**
   - 長期保存が必要な記録をアーカイブ
   - アーカイブ先の設定（例: テープ、クラウドストレージ）

**アーカイブ手順**:
```
Recording Server → Archive
- アーカイブ対象の記録を選択
- アーカイブ先を指定
- アーカイブを実行
```

## 録画データの検索と再生

### 検索機能

**検索条件**:
- ユーザー名
- 日時範囲
- セッションID
- 記録タイプ

**検索手順**:
1. Recording Server管理コンソール → Search
2. 検索条件を入力
3. 検索結果を表示

### 再生機能

**再生方法**:
- Webブラウザでの再生
- 専用プレーヤーでの再生
- ダウンロードして再生

**再生権限**:
- 管理者: すべての記録を再生可能
- 監査者: 許可された記録のみ再生可能
- ユーザー: 自分の記録のみ再生可能

## セキュリティとコンプライアンス要件

### セキュリティ設定

**暗号化設定**:
- 記録データの暗号化（AES-256）
- 転送中の暗号化（TLS 1.2以上）

**アクセス制御**:
- ロールベースのアクセス制御（RBAC）
- 記録へのアクセス権限の設定

**監査ログ**:
- 記録へのアクセスログ
- 記録の削除ログ
- 設定変更ログ

### コンプライアンス要件

**保持期間の管理**:
- 規制要件に基づく保持期間の設定
- 保持期間中の削除防止

**改ざん防止**:
- 記録データの整合性チェック
- デジタル署名の使用

**レポート生成**:
- 記録統計のレポート
- コンプライアンスレポート

## ベストプラクティス

1. **ストレージ管理**
   - 適切なストレージ容量の確保
   - 自動削除ポリシーの設定

2. **セキュリティ**
   - 記録データの暗号化
   - アクセス制御の設定

3. **パフォーマンス**
   - 記録品質の最適化
   - ネットワーク帯域幅の考慮

## まとめ

Recording Serverの適切なデプロイと設定は、コンプライアンス要件やセキュリティ監査に重要です。ユースケースの特定、前提条件の確認、記録基準の評価、適切なデプロイと設定により、効果的なセッション記録環境を構築できます。
