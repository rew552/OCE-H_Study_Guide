# 1.12 FIPS 140-2 Compliance

## 概要

FIPS 140-2（Federal Information Processing Standard）は、暗号化モジュールのセキュリティ要件を定義する標準です。OCE-Hレベルでは、Connection ServerとUAGでのFIPSモードデプロイメントの評価が求められます。

## FIPS 140-2モードデプロイメントでのConnection Server、UAGの評価

### FIPS 140-2の概要

**要件**:
- 承認された暗号化アルゴリズムの使用
- 暗号化モジュールの検証
- セキュリティポリシーの遵守

**適用範囲**:
- 政府機関
- 金融機関
- 医療機関
- その他の規制業界

### Connection ServerでのFIPSモード

**有効化手順**:

1. **Windows ServerでFIPSモードを有効化**
   ```powershell
   # レジストリでFIPSモードを有効化
   New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\FipsAlgorithmPolicy" -Name "Enabled" -Value 1 -PropertyType DWord -Force
   ```

2. **Connection Serverの再起動**
   ```powershell
   Restart-Service "VMware Horizon View Connection Server"
   ```

3. **FIPSモードの確認**
   - Horizon Console → View Configuration → Servers
   - Connection Serverの設定を確認

**詳細な設定手順**:

1. **Windows ServerでFIPSモードを有効化**
   ```powershell
   # レジストリでFIPSモードを有効化
   New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\FipsAlgorithmPolicy" `
       -Name "Enabled" -Value 1 -PropertyType DWord -Force
   
   # システムの再起動
   Restart-Computer -Force
   ```

2. **Connection Serverの設定確認**
   - Horizon Console → View Configuration → Servers
   - Connection Serverを選択 → Edit
   - Security Settings → FIPS Mode: Enabled

3. **FIPSモードの検証**
   ```powershell
   # FIPSモードの確認
   $fipsEnabled = Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\FipsAlgorithmPolicy" -Name "Enabled"
   if ($fipsEnabled.Enabled -eq 1) {
       Write-Host "FIPSモードは有効です"
   } else {
       Write-Host "FIPSモードは無効です"
   }
   ```

**証明書要件**:

**FIPS準拠の証明書**:
- FIPS 140-2準拠のCAから発行された証明書
- 承認された暗号化アルゴリズムを使用
- 適切な鍵長（RSA 2048ビット以上、ECDSA 256ビット以上）

**証明書の確認**:
```powershell
# 証明書の暗号化アルゴリズムを確認
$cert = Get-ChildItem -Path Cert:\LocalMachine\My | Where-Object {$_.Subject -like "*horizon*"}
$cert | Select-Object Subject, @{Name="Algorithm";Expression={$_.PublicKey.Key.SignatureAlgorithm}}, @{Name="KeySize";Expression={$_.PublicKey.Key.KeySize}}
```

**暗号化アルゴリズムの設定**:

**承認されたアルゴリズム**:
- **対称暗号**: AES-128、AES-192、AES-256
- **非対称暗号**: RSA（2048ビット以上）、ECDSA（P-256、P-384、P-521）
- **ハッシュ**: SHA-256、SHA-384、SHA-512

**TLS/SSL設定**:
```powershell
# FIPS準拠のTLS設定
# TLS 1.2のみを有効化
New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server" `
    -Name "Enabled" -Value 1 -PropertyType DWord -Force
New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server" `
    -Name "DisabledByDefault" -Value 0 -PropertyType DWord -Force

# 弱い暗号化スイートを無効化
# 承認された暗号化スイートのみを有効化
```

**影響**:
- 一部の機能が制限される可能性
- パフォーマンスへの影響（5-10%の低下が一般的）
- 互換性の問題（古いクライアントが接続できない可能性）

:::warning
FIPSモードを有効にすると、一部の機能が制限される可能性があります。本番環境で有効にする前に、テスト環境で十分に検証してください。
:::

### UAGでのFIPSモード

**有効化手順**:

1. **UAG管理コンソールにアクセス**
   - `https://<UAG IP>:9443`

2. **FIPSモードの有効化**
   - Settings → Security → FIPS Mode
   - FIPS Modeを有効化

3. **UAGの再起動**
   ```bash
   # SSH経由でUAGに接続
   ssh admin@<UAG IP>
   
   # UAGの再起動
   reboot
   ```

**影響**:
- 暗号化アルゴリズムの制限
- パフォーマンスへの影響
- クライアントとの互換性

### FIPSモードの評価

**考慮事項**:
1. **機能の制限**
   - 使用できない機能の確認
   - 代替手段の検討

2. **パフォーマンス**
   - パフォーマンスへの影響の評価
   - リソース要件の確認

3. **互換性**
   - クライアントとの互換性
   - 他のコンポーネントとの互換性

**コンプライアンス検証手順**:

1. **FIPSモードの確認**
   - Windows ServerでFIPSモードが有効であることを確認
   - Connection ServerとUAGでFIPSモードが有効であることを確認

2. **証明書の検証**
   - 使用している証明書がFIPS準拠であることを確認
   - 証明書の暗号化アルゴリズムを確認

3. **暗号化アルゴリズムの検証**
   - 使用している暗号化アルゴリズムが承認されていることを確認
   - 弱い暗号化スイートが無効化されていることを確認

4. **監査ログの確認**
   - FIPSモードの設定変更を記録
   - 定期的な監査の実施

**検証チェックリスト**:
- [ ] FIPSモードが有効であることを確認
- [ ] 証明書がFIPS準拠であることを確認
- [ ] 承認された暗号化アルゴリズムのみを使用していることを確認
- [ ] 弱い暗号化スイートが無効化されていることを確認
- [ ] パフォーマンステストを実施
- [ ] 機能テストを実施
- [ ] 監査ログを確認

:::important
FIPSモードは、規制要件がある環境でのみ有効化してください。不要な環境で有効化すると、機能の制限やパフォーマンスの低下を引き起こす可能性があります。
:::

## ベストプラクティス

1. **評価**
   - 要件の確認
   - 機能への影響の評価

2. **テスト**
   - テスト環境での検証
   - パフォーマンステスト

3. **ドキュメント**
   - 設定のドキュメント化
   - 変更管理プロセス

## まとめ

FIPS 140-2コンプライアンスは、規制要件がある環境で重要です。Connection ServerとUAGでのFIPSモードデプロイメントの適切な評価により、コンプライアンス要件を満たしながら、機能とパフォーマンスを維持できます。
