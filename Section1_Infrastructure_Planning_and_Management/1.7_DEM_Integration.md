# 1.7 DEM Integration

## 概要

Dynamic Environment Manager (DEM)の統合は、ユーザー環境とプロファイルの管理に重要です。OCE-Hレベルでは、ファイル共有の設定、Management Consoleのインストール、Smart Policies、条件セット、ADMXテンプレートのインポートが求められます。

## DEMデプロイメント用ファイル共有の設定

### ファイル共有の要件

**要件**:
- SMB 3.0以上をサポート
- 高可用性構成（推奨）
- 適切なアクセス権限

**推奨構成**:
- Windows Server 2016以降
- DFS (Distributed File System) を使用
- 複数のファイルサーバーで冗長化

### ファイル共有の作成

**手順**:

1. **ファイルサーバーで共有フォルダを作成**
   ```
   共有名: DEMShare
   パス: C:\DEMShare
   ```

2. **アクセス権限の設定**
   - DEM Service Accountに読み書き権限
   - ユーザーに読み取り権限

3. **DEMでの設定**
   - DEM Management Consoleでファイル共有を指定
   - パス: `\\fileserver\DEMShare`

**高可用性構成の詳細**:

#### DFS (Distributed File System) の使用

**DFSの利点**:
- 複数のファイルサーバーで冗長化
- 自動フェイルオーバー
- 負荷分散

**DFS名前空間の設定**:
```
DFS名前空間: \\contoso.com\DEMShare
ターゲット:
  - \\fileserver1.contoso.com\DEMShare
  - \\fileserver2.contoso.com\DEMShare
```

**DFSレプリケーションの設定**:
- 複数のファイルサーバー間でデータをレプリケート
- 自動同期
- 競合解決

#### クラスター構成

**Windows Server Failover Clusterの使用**:
- 複数のファイルサーバーをクラスター化
- 自動フェイルオーバー
- 共有ストレージの使用

**クラスター設定の例**:
```
クラスター名: DEM-FileServer-Cluster
ノード:
  - fileserver1.contoso.com
  - fileserver2.contoso.com
共有ストレージ: Cluster Shared Volume (CSV)
```

> [!IMPORTANT]
> DEMファイル共有は、高可用性を確保するために、複数のファイルサーバーで冗長化することを推奨します。

## DEM Management Consoleのインストール（NoAD含む）

### 標準インストール（Active Directory環境）

**手順**:

1. **Management Consoleのインストール**
   - インストーラーを実行
   - インストールタイプで「Management Console」を選択

2. **Active Directory統合**
   - ドメイン参加が必要
   - Service Accountの設定

3. **初期設定**
   - ファイル共有の指定
   - データベースの設定（オプション）

### NoADインストール（Active Directoryなし）

**ユースケース**:
- Active Directoryがない環境
- ワークグループ環境

**手順**:

1. **Management Consoleのインストール**
   - インストーラーを実行
   - NoADモードでインストール

2. **ローカル認証の設定**
   - ローカルユーザーアカウントの使用
   - ファイル共有の設定

> [!NOTE]
> NoADモードは、Active Directoryがない環境でのみ使用します。通常は、Active Directory環境での使用を推奨します。

## Horizon Smart Policiesのユースケースの特定

### Smart Policiesの概要

**機能**:
- 条件付きポリシーの適用
- 動的な環境設定
- ユーザー、デバイス、アプリケーションに基づく設定

### ユースケース

#### ユーザーグループに基づく設定

**例**:
- 管理者グループ: 管理者向け設定
- 一般ユーザーグループ: 標準設定

#### デバイスタイプに基づく設定

**例**:
- デスクトップ: フル機能
- タブレット: タッチ最適化

#### アプリケーションに基づく設定

**例**:
- 特定のアプリケーション起動時: 専用設定
- アプリケーション終了時: 設定の復元

> [!TIP]
> Smart Policiesを使用することで、ユーザーやデバイスに応じた動的な環境設定が可能になります。

## 条件セットの作成評価（モジュラーアプローチ）

### 条件セットの概要

**機能**:
- 複数の条件を組み合わせ
- モジュラーなポリシー設計
- 再利用可能な条件

### 条件セットの作成

**手順**:

1. **DEM Management Consoleで条件セットを作成**
   - Conditions → New Condition Set

2. **条件の追加**
   - ユーザーグループ
   - デバイスタイプ
   - アプリケーション
   - ネットワーク位置

3. **条件の組み合わせ**
   - AND条件
   - OR条件
   - NOT条件

**例**:
```
条件セット: "管理者デスクトップ"
- ユーザーグループ: "Domain Admins" AND
- デバイスタイプ: "Desktop"
```

> [!IMPORTANT]
> モジュラーアプローチにより、条件セットを再利用し、ポリシー管理を効率化できます。

## DEM準備のためのADMXテンプレートインポートの考慮

### ADMXテンプレートの概要

**機能**:
- Group Policyを使用したDEM設定の管理
- 一元管理
- 一貫性のある設定

### インポート手順

1. **ADMXテンプレートファイルの取得**
   - DEMインストールメディアから取得
   - または、DEM Management Consoleからダウンロード

2. **中央ストアへのコピー**
   ```
   コピー元: <DEMインストールメディア>\ADMX Templates\*.admx
   コピー先: \\<ドメイン名>\SYSVOL\<ドメイン名>\Policies\PolicyDefinitions\
   ```

3. **Group Policy Management Consoleでの確認**
   - GPOを編集
   - Computer ConfigurationまたはUser Configuration
   - Policies → Administrative Templates → VMware DEM

> [!CAUTION]
> ADMXテンプレートの適用は、すべての対象コンピューターに影響を与える可能性があります。テスト環境で十分に検証してください。

## プロファイルサイズの最適化

### プロファイルサイズの削減

**最適化方法**:

1. **フォルダリダイレクションの使用**
   - 大きなフォルダをネットワーク共有にリダイレクト
   - プロファイルサイズの削減

2. **不要なデータの除外**
   - DEM設定で除外フォルダを指定
   - 一時ファイル、キャッシュファイルを除外

3. **圧縮の使用**
   - プロファイルデータの圧縮
   - ストレージ使用量の削減

**除外フォルダの設定例**:
```
除外フォルダ:
- AppData\Local\Temp
- AppData\Local\Microsoft\Windows\INetCache
- AppData\Local\Microsoft\Windows\WebCache
```

## ログオン時間の最適化手法

### ログオン時間の最適化

**最適化方法**:

1. **プロファイルサイズの削減**
   - 上記のプロファイルサイズ最適化を実施

2. **非同期ログオンの使用**
   - 非同期ログオンを有効化
   - ログオン時間の短縮

3. **条件付きポリシーの使用**
   - 必要なポリシーのみを適用
   - 不要なポリシーの除外

4. **ネットワーク最適化**
   - 高速ネットワークへの接続
   - レイテンシの最小化

**非同期ログオンの設定**:
```
DEM Management Console → Policies → User Environment
→ Logon Settings → Asynchronous Logon: Enabled
```

## DEMとApp Volumesの統合シナリオ

### 統合の利点

**統合シナリオ**:
- DEMでユーザー環境を管理
- App Volumesでアプリケーションを配信
- 両方を組み合わせて包括的なソリューションを提供

**統合設定**:

1. **DEMの設定**
   - ユーザー環境ポリシーの設定
   - アプリケーション設定の管理

2. **App Volumesの設定**
   - アプリケーションのパッケージング
   - アプリケーションの配信

3. **統合の確認**
   - アプリケーション起動時の動作確認
   - ユーザー環境設定の適用確認

**統合のベストプラクティス**:
- DEMとApp Volumesの設定を一貫性を保つ
- 競合する設定を避ける
- テスト環境での検証

## ベストプラクティス

1. **ファイル共有**
   - 高可用性構成を推奨
   - 定期的なバックアップ

2. **Smart Policies**
   - 明確な条件定義
   - テスト環境での検証

3. **条件セット**
   - モジュラーアプローチの使用
   - 再利用可能な設計

4. **ADMXテンプレート**
   - 中央ストアの使用
   - 定期的な更新

## 理解度チェックリスト

以下の項目について理解度を確認してください：

### ファイル共有
- [ ] DEMデプロイ用ファイル共有の設定方法を理解している
- [ ] 高可用性構成（DFS、クラスター）の設定を説明できる

### Management Console
- [ ] DEM Management Consoleのインストール手順を理解している
- [ ] NoADモードでのインストール方法を説明できる

### Smart Policies
- [ ] Horizon Smart Policiesのユースケースを特定できる
- [ ] Smart Policiesの設定方法を理解している

### 条件セット
- [ ] 条件セット（モジュラーアプローチ）の作成評価方法を説明できる
- [ ] 条件セットの使用方法を理解している

### ADMXテンプレート
- [ ] DEM準備のためのADMXテンプレートインポートの考慮事項を理解している
- [ ] ADMXテンプレートのインポート手順を説明できる

## まとめ

DEMの適切な統合は、ユーザー環境とプロファイルの効率的な管理に重要です。ファイル共有の設定、Management Consoleのインストール、Smart Policies、条件セット、ADMXテンプレートの適切な使用により、柔軟で管理しやすいHorizon環境を構築できます。
