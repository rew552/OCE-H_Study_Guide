# 7.3 Omnissa Intelligence Integration

## 概要

## 関連リソース

- [クイックリファレンス](../../00_Quick_Reference.md) - ポート番号、設定値、制限値
- [用語集](../../README.md#用語集) - 関連用語の定義
- [1.5 Licenses and Edge Gateway](../../Section1_Infrastructure_Planning_and_Management/1.5_Licenses_Edge_Gateway.md) - Edge Gateway
- [実環境シナリオ](../../00_Scenarios/Section7_Scenarios.md) - 実環境でのシナリオ例

Omnissa Intelligenceとの統合は、Horizon環境の分析とレポート生成に重要です。OCE-Hレベルでは、Edge Gatewayのデプロイ、DEEMエージェントのインストール、Omnissa Intelligenceでのアクティブ化、カスタムレポートの生成が求められます。

## 学習目標

このセクションを学習することで、以下のことができるようになります：

- Edge GatewayをデプロイしてSubscription接続を設定できる
- Horizon Agent VMにDEEMエージェントをインストールできる
- connect.Omnissa.com → Intelligence → Marketplace → Solutions → Experience Management → Virtual Desktop & Appsタイルを有効化できる
- Omnissa Intelligenceでのレポート生成と分析ができる

## 関連リソース

- [クイックリファレンス](../../00_Quick_Reference.md) - ポート番号、設定値、制限値
- [用語集](../../README.md#用語集) - 関連用語の定義
- [1.5 Licenses and Edge Gateway](../../Section1_Infrastructure_Planning_and_Management/1.5_Licenses_Edge_Gateway.md) - Edge Gateway
- [実環境シナリオ](../../00_Scenarios/Section7_Scenarios.md) - 実環境でのシナリオ例

## Edge Gatewayのデプロイ

### Edge Gatewayの概要

**機能**:
- Horizon環境のメトリック収集
- Omnissa Intelligenceへのデータ送信
- セキュアなデータ転送

**要件**:
- vSphere環境（OVA形式）
- ネットワーク接続（インターネット）
- Omnissa Intelligenceサブスクリプション

### デプロイ手順

#### Edge Gatewayのダウンロード

**手順**:
1. **Omnissa Customer Connectにアクセス**
   - https://customerconnect.omnissa.com
   - ログイン

2. **Edge Gatewayのダウンロード**
   - Products → Horizon → Downloads
   - Edge Gatewayを選択
   - 最新バージョンをダウンロード
   - OVAファイルをダウンロード

#### vSphere環境でのデプロイ

**手順**:

1. **vSphere ClientでOVAをインポート**
   - File → Deploy OVF Template
   - OVAファイルを選択
   - Nextをクリック

2. **デプロイ設定**
   - **Name**: `horizon-edge-gateway`
   - **Folder**: 適切なフォルダを選択
   - **Datastore**: データストアを選択
   - **Network**: 管理ネットワークを選択

3. **カスタマイズプロパティ**
   - **IP Address**: Edge GatewayのIPアドレス
   - **Subnet Mask**: サブネットマスク
   - **Default Gateway**: デフォルトゲートウェイ
   - **DNS**: DNSサーバーのIPアドレス
   - **Hostname**: Edge Gatewayのホスト名

4. **デプロイの完了**
   - Finishをクリック
   - デプロイが完了するまで待機

#### 初期設定

**手順**:

1. **Edge Gatewayの電源投入**
   - vSphere ClientでVMの電源を投入
   - 起動を待機

2. **管理コンソールへのアクセス**
   - `https://<Edge Gateway IP>`
   - デフォルト認証情報でログイン
   - 初回ログイン時にパスワード変更

3. **ネットワーク設定の確認**
   - Settings → Network
   - IPアドレス、DNS設定を確認

4. **Omnissa Intelligenceへの接続設定**
   - Settings → Intelligence
   - Subscription URL: `https://connect.omnissa.com`
   - 認証情報を入力
   - Test Connectionをクリック

> [!IMPORTANT]

> Edge Gatewayは、Omnissa Intelligenceへのデータ送信にインターネット接続が必要です。ファイアウォールルールを適切に設定してください。

## Horizon agent VMにDEEMエージェントのインストール

### DEEMエージェントの概要

**機能**:
- Horizon環境のメトリック収集
- Edge Gatewayへのデータ送信
- パフォーマンスデータの収集

### インストール手順

#### DEEMエージェントの取得

**手順**:
1. **Omnissa Customer Connectからダウンロード**
   - Products → Horizon → Downloads
   - DEEM Agentを選択
   - インストーラーをダウンロード

2. **または、Edge Gatewayから取得**
   - Edge Gateway管理コンソール → Downloads
   - DEEM Agentインストーラーをダウンロード

#### インストール

**手順**:

1. **仮想デスクトップVMにインストール**
   - インストーラーを実行（管理者権限）
   - インストールウィザードの進行

2. **Edge Gatewayへの接続設定**
   - Edge GatewayのFQDNまたはIPアドレスを入力
   - ポート番号（デフォルト: 443）
   - 認証情報を入力

3. **設定の確認**
   - Agentサービスの状態確認
   - Edge Gatewayへの接続確認

**PowerShellでの確認**:
```powershell
# DEEM Agentサービスの状態確認
Get-Service | Where-Object {$_.Name -like "*DEEM*"}

# ログファイルの確認
Get-Content "C:\ProgramData\VMware\DEEM\logs\deem-agent.log" -Tail 50
```

#### 一括インストール

**PowerShellスクリプト例**:
```powershell
# DEEM Agentの一括インストール
$vms = Get-Content "vms.txt"  # VM名のリスト
$edgeGateway = "edge-gateway.contoso.com"

foreach ($vm in $vms) {
    # VMに接続してインストール
    Invoke-Command -ComputerName $vm -ScriptBlock {
        param($edgeGateway)
        # インストーラーを実行
        Start-Process -FilePath ".\DEEM-Agent-Setup.exe" `
            -ArgumentList "/S /EDGEGATEWAY=$edgeGateway" `
            -Wait
    } -ArgumentList $edgeGateway
}
```

> [!TIP]

> DEEMエージェントは、すべてのHorizon agent VMにインストールすることを推奨します。これにより、包括的な分析データを収集できます。

## connect.Omnissa.comにログイン。Intelligenceで、Marketplace > Solutions > Experience Managementに移動。Virtual Desktop & Appsタイルをアクティブ化

### アクティブ化手順（詳細）

**手順**:

1. **connect.Omnissa.comにログイン**
   - ブラウザで `https://connect.omnissa.com` にアクセス
   - Omnissaアカウントでログイン
   - アカウントがない場合は、新規登録

2. **Intelligenceへの移動**
   - ダッシュボードから「Intelligence」を選択
   - または、直接 `https://intelligence.omnissa.com` にアクセス

3. **Marketplaceへの移動**
   - Intelligenceダッシュボード → Marketplace
   - または、左側メニューから「Marketplace」を選択

4. **Solutions > Experience Management**
   - Marketplaceで「Solutions」を選択
   - 「Experience Management」カテゴリを選択

5. **Virtual Desktop & Appsタイルをアクティブ化**
   - 「Virtual Desktop & Apps」タイルを見つける
   - タイルをクリック
   - 「Activate」または「Enable」をクリック
   - アクティブ化が完了するまで待機

6. **Edge Gatewayの登録**
   - Edge Gatewayの情報を入力
   - Edge Gateway IDまたはFQDN
   - 接続テストを実行

7. **検証**
   - ダッシュボードでデータが表示されることを確認
   - レポートが生成されることを確認

> [!IMPORTANT]

> Virtual Desktop & Appsタイルのアクティブ化により、Horizon環境の詳細な分析とレポートが可能になります。アクティブ化後、データの収集と表示までに数時間かかる場合があります。

## カスタムレポートの生成

### レポートの種類

**利用可能なレポート**:
- セッションレポート
- パフォーマンスレポート
- 使用状況レポート
- エラーレポート

### カスタムレポートの作成

**手順**:
1. Intelligenceダッシュボード → Reports
2. New Reportをクリック
3. レポートタイプを選択
4. フィルターと条件を設定
5. レポートを生成

## ベストプラクティス

1. **デプロイ**
   - 適切なネットワーク設定
   - セキュリティ設定
   - ファイアウォールルールの設定

2. **モニタリング**
   - データ送信の確認
   - Edge Gatewayの状態監視
   - DEEM Agentの状態監視

3. **メンテナンス**
   - 定期的な更新
   - ログファイルの確認
   - パフォーマンスの監視

> [!WARNING]

> Edge GatewayとDEEM Agentは、インターネット接続が必要です。ファイアウォールルールを適切に設定し、セキュリティを確保してください。

## トラブルシューティング

### 一般的な問題

**データが表示されない**:
- Edge Gatewayの接続を確認
- DEEM Agentの状態を確認
- ネットワーク接続を確認

**Edge Gatewayに接続できない**:
- ネットワーク接続を確認
- ファイアウォールルールを確認
- Edge Gatewayの状態を確認

**DEEM Agentが動作しない**:
- Agentサービスの状態を確認
- ログファイルを確認
- Edge Gatewayへの接続を確認

### ログファイルの確認

**Edge Gatewayログ**:
- Edge Gateway管理コンソール → Logs
- または、SSH経由でアクセス

**DEEM Agentログ**:
- `C:\ProgramData\VMware\DEEM\logs\deem-agent.log`

## レポートと分析の詳細

### 利用可能なレポート

**標準レポート**:
- **セッション統計**: セッション数、使用時間、ユーザー統計
- **パフォーマンスメトリック**: CPU、メモリ、ディスク、ネットワーク
- **容量分析**: リソース使用率、容量計画
- **セキュリティイベント**: 認証、アクセス、セキュリティイベント

**カスタムレポートの作成**:
- Omnissa Intelligenceコンソール → Reports → Custom Reports
- 新しいレポートを作成
- メトリックとディメンションを選択
- フィルターと条件を設定

## アラートと通知の設定

### アラートの設定

**アラート条件**:
- **リソース使用率**: CPU、メモリ、ディスクの使用率が閾値を超えた場合
- **セッション数**: セッション数が閾値を超えた場合
- **パフォーマンス**: 応答時間が閾値を超えた場合
- **エラー**: エラー率が閾値を超えた場合

**アラート設定例**:
```
アラート名: High CPU Usage
条件: CPU使用率 > 80%
期間: 5分間継続
通知: Email, SMS
```

**通知の設定**:
- Email通知
- SMS通知
- Webhook通知
- SNMP通知

## まとめ

Omnissa Intelligenceとの適切な統合は、Horizon環境の分析とレポート生成に重要です。Edge Gatewayのデプロイ、DEEMエージェントのインストール、Intelligenceでのアクティブ化、カスタムレポートの生成、レポートと分析の詳細、アラートと通知の設定により、包括的な分析環境を構築できます。
