# Section 6: Scale and Recovery 実環境シナリオ

このドキュメントでは、Section 6に関連する実環境シナリオを提供します。

## シナリオ1: 環境のスケーリング

### 要件

- **現在の環境規模**: 1,000 CCU
- **目標**: 3,000 CCUへの拡張
- **制約**: ダウンタイムを最小限に抑える

### 環境

- 既存のHorizon環境
- Connection Server: 3台
- UAG: 3台

### 課題

1. Connection Serverの追加
2. UAGの追加
3. ストレージの拡張

### 解決策

#### Connection Serverの追加

- **追加**: 2台のConnection Serverを追加（合計5台）
- **手順**: Replica Serverとして追加
- **検証**: レプリケーションが正常に動作することを確認

#### UAGの追加

- **追加**: 2台のUAGを追加（合計5台、1:1比率を維持）
- **手順**: 既存のUAGと同じ設定で追加
- **検証**: ロードバランサーに追加して検証

#### ストレージの拡張

- **容量**: ストレージ容量を3倍に拡張
- **IOPS**: ストレージIOPSを増加
- **検証**: パフォーマンスを確認

### 考慮事項

- 段階的に拡張を実施
- 各段階で検証を実施
- ダウンタイムを最小限に抑える

---

## シナリオ2: CPAの実装

### 要件

- **環境規模**: 2つのサイト（各1,000 CCU）
- **要件**: 2つのサイトを統合管理
- **制約**: 既存の環境への影響を最小限に抑える

### 環境

- サイトA: 東京（既存のHorizon環境）
- サイトB: 大阪（新規のHorizon環境）
- サイト間ネットワーク: 専用回線

### 課題

1. CPAの初期化
2. ポッドの参加
3. グローバルエンタイトルメントの設定

### 解決策

#### CPAの初期化

- **手順**: 最初のポッド（東京）でCPAを初期化
- **設定**: フェデレーション名、グローバルLDAPインスタンスを設定
- **検証**: 初期化が正常に完了したことを確認

#### ポッドの参加

- **手順**: 2番目のポッド（大阪）をフェデレーションに参加
- **設定**: 既存のフェデレーション情報を入力
- **検証**: ポッドが正常に参加したことを確認

#### グローバルエンタイトルメントの設定

- **作成**: グローバルエンタイトルメントを作成
- **プールの追加**: 両サイトのプールを追加
- **Home Site**: ユーザーのHome Siteを設定

### 考慮事項

- サイト間のネットワーク接続を確保
- レイテンシを監視
- フェイルオーバー手順を準備

---

## シナリオ3: 災害復旧計画の策定

### 要件

- **環境規模**: 2,000 CCU
- **要件**: RTO 4時間、RPO 1時間
- **制約**: コスト効率的な実装

### 環境

- プライマリサイト: 東京
- セカンダリサイト: 大阪
- サイト間ネットワーク: 専用回線

### 課題

1. バックアップ戦略の策定
2. レプリケーション戦略の策定
3. フェイルオーバー手順の策定

### 解決策

#### バックアップ戦略

- **Connection Server**: 設定のエクスポート、データベースのバックアップ
- **App Volumes**: データベースのバックアップ、ストレージのレプリケーション
- **DEM**: ファイル共有のバックアップ
- **頻度**: RPOに基づいて1時間ごと

#### レプリケーション戦略

- **vSphere SRM**: Site Recovery Managerを使用
- **ストレージレプリケーション**: ストレージレベルでのレプリケーション
- **データベースレプリケーション**: SQL Server Always On

#### フェイルオーバー手順

- **自動フェイルオーバー**: 可能な場合は自動フェイルオーバー
- **手動フェイルオーバー**: 詳細な手順を文書化
- **テスト**: 定期的にDRテストを実施

### 考慮事項

- RTO/RPO要件を満たす
- 定期的にDRテストを実施
- フェイルオーバー手順を文書化

---

## まとめ

これらのシナリオは、スケーリングと災害復旧に関する実践的な知識を提供します。各シナリオを理解し、解決策を検討することで、実環境でのスケーリングと災害復旧の知識を習得できます。
