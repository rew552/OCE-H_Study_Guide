# Section 1: Infrastructure Planning and Management 実環境シナリオ

このドキュメントでは、Section 1に関連する実環境シナリオを提供します。

## シナリオ1: 小規模環境での高可用性構成

### 要件

- **環境規模**: 200 CCU
- **要件**: 高可用性を確保しつつ、コストを最小限に抑える
- **制約**: 予算が限られている

### 環境

- 単一データセンター
- 既存のvSphere環境
- Active Directory環境

### 課題

1. Connection Serverの高可用性構成
2. UAGの高可用性構成
3. コスト効率的な実装

### 解決策

#### Connection Server構成

- **推奨**: 2台のConnection Server（レプリケーショングループ）
- **理由**: 200 CCUであれば2台で十分。3台目はコストに見合わない
- **構成**:
  - Connection Server 1: プライマリ
  - Connection Server 2: レプリカ
  - ロードバランサー: ソフトウェアベース（例: Windows NLB、Linux HAProxy）

#### UAG構成

- **推奨**: 2台のUAG（1:1比率でConnection Serverと統合）
- **構成**:
  - UAG 1 ↔ Connection Server 1
  - UAG 2 ↔ Connection Server 2
  - 外部ロードバランサー: サードパーティまたはUAG HA機能

#### データベース

- **推奨**: 組み込みデータベース（200 CCUでは十分）
- **理由**: 外部データベースのライセンスコストを削減

### 考慮事項

- ロードバランサーはソフトウェアベースで十分
- 定期的なバックアップを実施
- メンテナンスウィンドウを計画

---

## シナリオ2: 中規模環境でのマルチサイト構成

### 要件

- **環境規模**: 2,000 CCU
- **要件**: 2つのデータセンター間で負荷分散
- **制約**: レイテンシ要件（各サイト間50ms以下）

### 環境

- データセンターA: 東京（1,000 CCU）
- データセンターB: 大阪（1,000 CCU）
- サイト間ネットワーク: 専用回線（100Mbps）

### 課題

1. 2つのサイト間での負荷分散
2. ユーザーの最適なサイトへの接続
3. データのレプリケーション

### 解決策

#### Cloud Pod Architecture (CPA)の実装

- **構成**: 2つのポッドをCPAで統合
- **Pod 1**: 東京データセンター
  - Connection Server: 3台
  - UAG: 3台
- **Pod 2**: 大阪データセンター
  - Connection Server: 3台
  - UAG: 3台

#### Home Site戦略

- **設定**: ユーザーの物理的な位置に基づいてHome Siteを設定
- **実装**: Imvutilコマンドで一括設定
- **効果**: レイテンシの最小化とデータの局所性

#### グローバルエンタイトルメント

- **構成**: 両サイトのプールをGlobal Entitlementに追加
- **ロードバランシング**: 自動的に最適なサイトに接続

### 考慮事項

- サイト間のネットワーク帯域幅を確保
- レイテンシを定期的に監視
- フェイルオーバー手順を文書化

---

## シナリオ3: 大規模環境でのCPA実装

### 要件

- **環境規模**: 10,000 CCU
- **要件**: 3つのデータセンター（東京、大阪、福岡）での統合管理
- **制約**: 各サイトで独立した運用も可能にする

### 環境

- データセンターA: 東京（4,000 CCU）
- データセンターB: 大阪（3,000 CCU）
- データセンターC: 福岡（3,000 CCU）
- 各サイト間: 専用回線（1Gbps）

### 課題

1. 3つのサイトを統合管理
2. グローバルエンタイトルメントの管理
3. サイト障害時の自動フェイルオーバー

### 解決策

#### CPA構成

- **フェデレーション**: 3つのポッドを統合
- **各ポッドの構成**:
  - Connection Server: 5台（高可用性と負荷分散）
  - UAG: 5台（1:1比率）
  - 外部データベース: SQL Server Always On

#### グローバルLDAPインスタンス

- **構成**: 中央のActive DirectoryをグローバルLDAPとして使用
- **各ポッド**: ローカルLDAPインスタンスも設定（フォールバック用）

#### サイト設定

- **Preferred Site**: ユーザーの物理的な位置に基づく
- **Allowed Sites**: すべてのサイトを許可
- **Blocked Sites**: なし（すべてのサイトにアクセス可能）

#### フェイルオーバー戦略

- **自動フェイルオーバー**: サイト障害を自動検出
- **フェイルオーバー時間**: 30秒以内
- **復旧手順**: 詳細な手順を文書化

### 考慮事項

- グローバルエンタイトルメントの設計を慎重に計画
- サイト間のネットワーク帯域幅を十分に確保
- 定期的なDRテストを実施

---

## シナリオ4: App VolumesとDEMの統合

### 要件

- **環境規模**: 1,500 CCU
- **要件**: アプリケーションの動的配信とプロファイル管理
- **制約**: 既存のファイルサーバーインフラを活用

### 環境

- 既存のWindowsファイルサーバー（2台）
- SQL Server環境（既存）
- Active Directory環境

### 課題

1. App Volumes Managerの高可用性構成
2. DEMファイル共有の高可用性構成
3. Horizon Connection Serverとの統合

### 解決策

#### App Volumes Manager構成

- **構成**: 2台のApp Volumes Manager
- **データベース**: SQL Server Always On（既存環境を活用）
- **ストレージ**: 既存のNFSストレージを使用

#### DEMファイル共有構成

- **構成**: DFS (Distributed File System) を使用
- **ファイルサーバー**: 既存の2台を活用
- **DFS名前空間**: `\\contoso.com\DEMShare`
- **レプリケーション**: DFSレプリケーションで自動同期

#### 統合設定

- **Horizon Console**: App Volumes ManagerとDEMを統合
- **Service Account**: 専用のService Accountを作成
- **権限設定**: 適切な権限を付与

### 考慮事項

- DFSレプリケーションの競合解決を理解する
- ストレージ容量を適切に計画
- 定期的なバックアップを実施

---

## シナリオ5: FIPS 140-2コンプライアンス要件

### 要件

- **環境規模**: 500 CCU
- **要件**: FIPS 140-2コンプライアンス要件への対応
- **制約**: 既存の環境をFIPSモードに移行

### 環境

- 既存のHorizon環境
- 政府機関のコンプライアンス要件

### 課題

1. Connection ServerのFIPSモード有効化
2. UAGのFIPSモード有効化
3. 既存環境への影響の最小化

### 解決策

#### Connection ServerのFIPSモード

- **手順**: インストール時にFIPSモードを有効化
- **既存環境**: 再インストールが必要（メンテナンスウィンドウ）
- **検証**: FIPSモードが有効であることを確認

#### UAGのFIPSモード

- **手順**: UAGインストール時にFIPSモードを有効化
- **証明書**: FIPS準拠の証明書を使用
- **検証**: FIPSモードが有効であることを確認

#### 移行計画

- **フェーズ1**: テスト環境で検証
- **フェーズ2**: 本番環境で段階的に移行
- **フェーズ3**: すべてのコンポーネントでFIPSモードを有効化

### 考慮事項

- FIPSモードはパフォーマンスに影響を与える可能性がある
- すべてのコンポーネントでFIPSモードを有効化する必要がある
- コンプライアンス要件を満たしていることを定期的に確認

---

## シナリオ6: GPUリソースの割り当て

### 要件

- **環境規模**: 300 CCU（GPU要件: 100 CCU）
- **要件**: CAD/CAMアプリケーション用のGPUリソース
- **制約**: 限られたGPUリソース

### 環境

- NVIDIA GRID GPU搭載サーバー（4台）
- 各サーバー: 4つのGPU（各GPU: 16GB VRAM）

### 課題

1. GPUリソースの効率的な割り当て
2. VM密度の最適化
3. パフォーマンスの確保

### 解決策

#### GPUプロファイルの選択

- **vGPUプロファイル**: NVIDIA GRID vGPU (4GB profile)
- **理由**: 100 CCUに対して16個のGPU（4サーバー × 4 GPU）で、適切な密度を実現
- **計算**: 16 GPU × 4 vGPU/GPU = 64 vGPU（100 CCUには十分）

#### VM密度の最適化

- **推奨密度**: GPUあたり4-6 VM
- **理由**: CAD/CAMアプリケーションの要件を考慮
- **監視**: GPU使用率を定期的に監視

#### リソースプールの設定

- **GPU専用プール**: CAD/CAMアプリケーション用
- **非GPUプール**: 通常のオフィス作業用
- **分離**: GPUリソースを適切に分離

### 考慮事項

- GPUドライバーのバージョンを統一
- GPUリソースの使用率を定期的に監視
- 必要に応じてGPUプロファイルを調整

---

## まとめ

これらのシナリオは、実際のHorizon環境で遭遇する可能性のある要件や課題を示しています。各シナリオを理解し、解決策を検討することで、実践的な知識を習得できます。

試験では、このようなシナリオに基づいた問題が出題される可能性があります。要件を正確に理解し、適切な解決策を選択する能力が求められます。
